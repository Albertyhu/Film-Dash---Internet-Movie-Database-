<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Film Dash</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel ="stylesheet" href='../../stylesheets/style.css'> 
  <link rel="icon" type="image/x-icon" href="/images/favicon.png">
  <script>
    var KnownForArray = []; 
        <% if( typeof DirectorWork != 'undefined') { %>
            var StringKnownWork = '<%= DirectorWork %>'
            KnownForArray = StringKnownWork.split(',');
        <%}%>
  </script>
</head>
<body class = "bg-black h-auto">
  <div 
  id="container"
  class = "w-full flex flex-col relative grow min-h-[120vh]">
      <div 
        id = "contentWrapper"
        class = "pb-[5.5rem]">
          <div class = "w-full mb-[100px]">
            <%- include("partials/header") %>
            <%- include("partials/MobileMenu") %>
          </div>
          <h1 class = "text-white text-center text-4xl mt-[100px]"><%= title %></h1>
          <div class = "w-11/12 mx-auto sm:w-5/12 ">
          <form
            action="" 
            method="POST"
            class="[&>div>label]:text-white [&>div]:grid mt-[50px] [&>div>input]:rounded-lg 
            [&>div]:w-full [&>div]:my-[10px] [&>div>input]:pl-3 [&>div>input]:bg-[rgba(0,0,0,0)] 
            [&>div>input]:text-white [&>div>input]:border-white [&>div>input]:border-[1px]" 
            >
            <div>
                <label for = "name">Name</label>
                <input 
                    name = "name" 
                    id = "nameInput"
                    type = "text"
                    placeholder = "Name of director" 
                    required = "true"
                    class = ""
                    value = "<%=  typeof director != 'undefined' ? director.name : null %>"
                    />
            </div>
            <div>
                <label for="known_for">Movies or other works known for</label>
                <div class = "block whitespace-nowrap">
                    <input 
                        id = "KnownForHiddenInput"
                        type = 'hidden' 
                        name = "known_for" 
                    />
                    <input 
                        name = "known_for" 
                        id = "KnownForInput"
                        type = "text"
                        placeholder = "Related work" 
                        class = "inline-block rounded-lg bg-[rgba(0,0,0,0)] text-white border-white border-[1px] 
                        pl-3 min-w-[80%]"
                        />
                     <div
                        id="AddKnownForButton"
                        class = "inline-block text-sm rounded-full p-1 active:translate-x-[5px] active:translate-y-[5px] cursor-pointer
                        border-white border-2 text-center select-none text-white mx-1
                        hover:bg-gray-800 min-w-[50px] w-auto"
                        onClick = "AddRelatedWork"
                     >Add</div>
                 </div>
            </div>
            <div 
                id = "KnownForAnswers"
                class = 'w-full my-5 mx-auto flex h-[20px] bg-black max-w-[200px] overflow-y-auto'
                >

            </div>
            <%- include('partials/FormButtons')%>
          </form>
          </div>
      </div>
      <%- include('partials/footer') %>
  </div>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <script>
    var KnownForInput = document.getElementById('KnownForInput'); 
    var AddKnownForButton = document.getElementById('AddKnownForButton');
    var KnownForAnswers = document.getElementById('KnownForAnswers');
    var KnownForHiddenInput = document.getElementById('KnownForHiddenInput'); 

    if(KnownForArray.length > 0){
        KnownForAnswers = document.getElementById('KnownForAnswers');
        KnownForHiddenInput = document.getElementById('KnownForHiddenInput'); 
        KnownForHiddenInput.value = KnownForArray; 
        KnownForArray.forEach(val =>{
            const UserInput = val;
            const NewInput = document.createElement('div')
            const NewInputDiv = document.createElement('div');
            NewInputDiv.innerHTML = UserInput; 
            NewInput.classList.add('KnownForTag');
            NewInput.appendChild(NewInputDiv)
            KnownForAnswers.appendChild(NewInput);

            const DeleteButton = document.createElement('img')
            DeleteButton.alt = "Delete";
            DeleteButton.classList.add("MiniDeleteButton")
            DeleteButton.src = "/icon/cancel.png"
            NewInput.appendChild(DeleteButton)
            KnownForAnswers.style.display = "table"

            NewInput.addEventListener('click', ()=>{
                var tempArr = KnownForArray; 
                tempArr = KnownForArray.filter(val => val !== UserInput)
                KnownForArray = tempArr;
                KnownForAnswers.removeChild(NewInput)
                console.log("After deletion: ", KnownForArray)
            })

        })
    }

    const AddRelatedWork = () => { 
        KnownForInput = document.getElementById('KnownForInput'); 
        KnownForAnswers = document.getElementById('KnownForAnswers');
        const UserInput = KnownForInput.value;
        if(UserInput.trim() != ""){
            KnownForArray.push(UserInput)
   
            console.log("KnownForArray: ", KnownForArray)

            const NewInput = document.createElement('div')
            const NewInputDiv = document.createElement('div');
            NewInputDiv.innerHTML = UserInput; 
            NewInput.classList.add('KnownForTag');
            NewInput.appendChild(NewInputDiv)
            KnownForAnswers.appendChild(NewInput);

            const DeleteButton = document.createElement('img')
            DeleteButton.alt = "Delete";
            DeleteButton.classList.add("MiniDeleteButton")
            DeleteButton.src = "/icon/cancel.png"
            NewInput.appendChild(DeleteButton)
            KnownForAnswers.style.display = "table"

            NewInput.addEventListener('click', ()=>{
                var tempArr = KnownForArray; 
                tempArr = KnownForArray.filter(val => val !== UserInput)
                KnownForArray = tempArr;
                KnownForAnswers.removeChild(NewInput)
                console.log("After deletion: ", KnownForArray)
            })
            KnownForInput.value = ""
            

            KnownForHiddenInput = document.getElementById('KnownForHiddenInput'); 
            KnownForHiddenInput.value = KnownForArray; 
        }
    }
    AddKnownForButton.addEventListener('click', AddRelatedWork)
  </script>
</body>
</html>